<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Qlik Embed con token desde backend</title>
  <script
    crossorigin="anonymous"
    type="application/javascript"
    src="https://cdn.jsdelivr.net/npm/@qlik/embed-web-components@1/dist/index.min.js"
    data-host="https://keyruspt.eu.qlikcloud.com"
    data-client-id="f6706182174fc70842b6161db71246ba"
    data-get-access-token="getAccessToken"
    data-auth-type="Oauth2"
  ></script>
</head>
<body>
  <h1>Ejemplo Qlik Embed Web Components</h1>
  
  <!-- Aquí podrías usar los componentes de Qlik, por ejemplo un botón para abrir app -->

  <script>
    async function getAccessToken() {
      try {
        const response = await fetch("/access-token", {
          method: "POST",
          credentials: "include",  // si usas cookies, o ajustar según tu backend
          mode: "same-origin",
          redirect: "follow",
        });

        if (response.ok) {
          const token = await response.text();
          return token;
        } else {
          throw new Error(`Error al obtener token: ${response.status}`);
        }
      } catch (error) {
        console.error("Error en getAccessToken:", error);
        throw error;
      }
    }
  </script>
</body>
</html>
